@model AttendancePortal.Models.CoursesViewModel
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Below are the Courses you can manage:</h1>
<div>
    @foreach (var course in Model.Courses)
    {
        <div>
            <h3>
                <span data-toggle="modal" data-coursetitle="@course.CourseName" data-courseid="@course.Id" class="course-item">
                    <a href="#" data-toggle="tooltip"  data-placement="right" title="Please click to add or remove students and change check in window time">@course.CourseName</a>
                </span>
            </h3>
        </div>
    }
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel"></h4>
            </div>
            <div class="modal-body">
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary btn-save-coursedetails">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $('.course-item')
        .on('click',
            function() {
                var course = $(this);
                $.ajax({
                        url: "/home/GetCourseDetails?courseId=" + course.data('courseid'),
                        type: "POST",
                        cache : false
                    })
                    .done(function(response) {
                        $('.modal-body').html(response);
                        $('.modal-title').html(course.data('coursetitle'));
                        $('#myModal').modal('show');
                    });

            });

    $('.btn-save-coursedetails').click(function () {
        var arr = new Array();
        $(".students-in-course").each(function (index, element) {
            var $o = $(element);
            var obj = {
                Name: $o.find('span').html(),
                Selected: $o.find('input').is(":checked"),
                Id: $o.find('span').data('studentid')
            };

            arr.push(obj);
        });
        
        var formData = {
            BeforeCheckIn: $('#BeforeCheckIn').val(),
            AfterCheckIn: $('#AfterCheckIn').val(),
            Students : arr
        };

        $.ajax({
                url: "/home/SaveCourseDetails",
                type: "POST",
                cache: false,
                data: formData
            })
            .done(function(response) {
            });
    });
</script>
